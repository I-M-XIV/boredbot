<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BoredBot - Just a Simple Chatbot</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
    <div class="chatbot-container">
        <div class="header-container">
            <img src="images/BoredBot.png" alt="BoredBot Logo" class="logo">
            <h1>BoredBot</h1>
        </div>
        <div class="button-group">
            <button onclick="clear_chat()" class="clear-button">Clear Chat</button>
            <button onclick="toggleTheme()" class="theme-toggle-button">Mode</button>
        </div>
        <div id="chatbox" class="chatbox">
            <div id="chat-log" class="chat-log"></div>
        </div>
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type /help for available prompts..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>    
    <script type="py-script">
        from js import document
        
        # Initialize global variables
        user_name = None
        
        # Sentiment words and responses
        sentiment_words = {
            "positive": [
                "happy", "great", "good", "fantastic", "awesome", "love", "excited",
                "wonderful", "amazing", "excellent", "fortunate", "marvelous", "positive",
                "nice", "pleasant", "enjoy", "delight", "cheerful", "perfect", "smile"
            ],
            "negative": [
                "sad", "bad", "terrible", "awful", "hate", "angry", "horrible",
                "unfortunate", "miserable", "depressed", "negative", "cry", "pain",
                "fail", "worse", "problem", "unhappy", "annoyed", "frustrated", "stress"
            ]
        }
        
        positive_responses = ["That sounds great!", "Glad to hear that!", "Awesome!"]
        negative_responses = ["I'm sorry to hear that.", "I hope things get better.", "That sounds tough."]
        
        # Function to handle user input and generate a response
        def sendMessage():
            global user_name
            input_box = document.getElementById("user-input")
            user_message = input_box.value.strip()
            
            if not user_message:
                return  # Do nothing if input is empty
            
            # Clear input box
            input_box.value = ""
            
            # Check if user is introducing their name
            if "my name is" in user_message.lower() or "i am" in user_message.lower():
                user_name = user_message.split()[-1].capitalize()  # Extract last word as name
                display_message(f"Nice to meet you, {user_name}!", sender="BoredBot")
                return
            
            # Sentiment analysis
            response = ""
            for word in user_message.split():
                if word.lower() in sentiment_words["positive"]:
                    response = positive_responses[0]
                    break
                elif word.lower() in sentiment_words["negative"]:
                    response = negative_responses[0]
                    break
            
            # If user input is a mathematical expression, evaluate it
            if response == "":
                try:
                    # Simple mathematical evaluation using eval (only safe if strictly controlled)
                    response = str(eval(user_message))
                except:
                    response = "I'm here to chat with you!"
            
            # Display user message with their name if available
            display_message(user_message, sender=user_name or "You")
            display_message(response, sender="BoredBot")
        
        # Function to display messages in the chat log
        def display_message(message, sender="You"):
            chat_log = document.getElementById("chat-log")
            user_display_name = user_name if sender == "You" and user_name else sender
            chat_log.innerHTML += f"<p><strong>{user_display_name}:</strong> {message}</p>"
            chat_log.scrollTop = chat_log.scrollHeight  # Auto-scroll to the bottom
        
        # Clear chat log
        def clear_chat():
            document.getElementById("chat-log").innerHTML = ""
        
        # Toggle theme
        def toggleTheme():
            chatbox = document.getElementById("chatbox")
            chatbox.classList.toggle("dark-mode")
        </script>        
</body>
</html>
